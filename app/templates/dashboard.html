{% extends "base.html" %}
{% block title %}ä»ªå™¨ä»ªè¡¨ç›˜{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mb-4">
    <h2>ä»ªå™¨åˆ—è¡¨</h2>
    <form class="d-flex" method="GET" action="{{ url_for('dashboard') }}">
        <input type="text" name="search" class="form-control me-2" placeholder="æœç´¢ä»ªå™¨åç§°..." value="{{ request.args.get('search', '') }}">
        <select name="status" class="form-select me-2" style="width: 150px;">
            <option value="">æ‰€æœ‰çŠ¶æ€</option>
            <option value="available" {% if request.args.get('status') == 'available' %}selected{% endif %}>å¯ç”¨</option>
            <option value="borrowed" {% if request.args.get('status') == 'borrowed' %}selected{% endif %}>å·²å€Ÿå‡º</option>
            <option value="maintenance" {% if request.args.get('status') == 'maintenance' %}selected{% endif %}>ç»´æŠ¤ä¸­</option>
        </select>
        <button type="submit" class="btn btn-outline-primary">ç­›é€‰</button>
    </form>
</div>

<div class="row row-cols-1 row-cols-md-3 g-4">
    {% for device in devices %}
    <div class="col">
        <div class="card h-100 shadow">
            <div class="card-header">
                <span class="badge bg-{{ 'success' if device.status == 'available' else 'danger' if device.status == 'borrowed' else 'warning'}}">
                    {{ device.status }}
                </span>
            </div>
            <div class="card-body">
                <h5 class="card-title">{{ device.name }}</h5>
            </div>
            <div class="card-footer bg-transparent">
            {% if device.status == 'available' %}
            <a href="{{ url_for('borrow', device_id=device.id) }}" class="btn btn-sm btn-primary">å€Ÿå‡º</a>
            {% else %}
            <button class="btn btn-sm btn-secondary" disabled>ä¸å¯å€Ÿ</button>
            {% endif %}

            {% if current_user.role == 'admin' %}
            <div class="btn-group ms-2">
                        <form role="menuitem" method="POST" action="{{ url_for('admin_device', device_id=device.id) }}">
                         <button type="submit" class="dropdown-item">
                             {% if device.status == 'available' %}
                                 â–¶ æ ‡è®°ä¸ºå·²å€Ÿå‡º
                             {% elif device.status == 'borrowed' %}
                                 â–¶ æ ‡è®°ä¸ºç»´æŠ¤ä¸­
                             {% else %}
                                  â–¶ æ¢å¤ä¸ºå¯ç”¨
                             {% endif %}
                         </button>
                     </form>

            <!-- åˆ é™¤è®¾å¤‡ -->

                     <form role="menuitem" method="POST" action="{{ url_for('delete_device', device_id=device.id) }}"
                            onsubmit="return confirm('ç¡®è®¤æ°¸ä¹…åˆ é™¤è¯¥è®¾å¤‡ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼');">
                         <button type="submit" class="dropdown-item text-danger">ğŸ—‘ åˆ é™¤è®¾å¤‡</button>
                     </form>

                </ul>
            </div>
         {% endif %}
</div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä»ªå™¨</div>
    </div>
    {% endfor %}
</div>
{% endblock %}